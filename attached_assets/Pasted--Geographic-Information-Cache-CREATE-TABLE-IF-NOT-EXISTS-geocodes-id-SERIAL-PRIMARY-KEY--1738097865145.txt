
-- Geographic Information Cache
CREATE TABLE IF NOT EXISTS geocodes (
    id SERIAL PRIMARY KEY,
    latitude DOUBLE PRECISION,  -- Location coordinates
    longitude DOUBLE PRECISION, -- Location coordinates
    full_address TEXT,         -- Complete address from geocoding
    city VARCHAR(255),         -- City/Municipality name
    state VARCHAR(255),        -- State/Region name
    country VARCHAR(255),      -- Country name
    postcode VARCHAR(255),     -- Postal/ZIP code
    UNIQUE (latitude, longitude)
);

-- Weather Station Information
CREATE TABLE IF NOT EXISTS stations (
    station_id VARCHAR(255) PRIMARY KEY,  -- Unique station identifier
    name VARCHAR(255),                    -- Station name
    city VARCHAR(255),                    -- City where station is located
    state VARCHAR(255),                   -- State where station is located
    country VARCHAR(255),                 -- Country where station is located
    latitude DOUBLE PRECISION,            -- Station latitude
    longitude DOUBLE PRECISION,           -- Station longitude
    last_updated TIMESTAMP DEFAULT CURRENT_TIMESTAMP -- Last update timestamp
);

-- Weather Observations Data
CREATE TABLE IF NOT EXISTS observations (
    id SERIAL PRIMARY KEY,
    station_id VARCHAR(255),              -- References stations table
    observation_timestamp TIMESTAMP,       -- When observation was recorded
    UNIQUE(station_id, observation_timestamp),
    temperature DOUBLE PRECISION,         -- Temperature in Celsius
    feels_like DOUBLE PRECISION,          -- Perceived temperature
    dew_point DOUBLE PRECISION,           -- Dew point temperature
    humidity DOUBLE PRECISION,            -- Relative humidity percentage
    precipitation_accumulated_daily DOUBLE PRECISION, -- Daily rainfall
    precipitation_rate DOUBLE PRECISION,  -- Current rainfall rate
    wind_speed DOUBLE PRECISION,          -- Wind speed
    wind_gust DOUBLE PRECISION,           -- Wind gust speed
    wind_direction INTEGER,               -- Wind direction in degrees
    uv_index INTEGER,                     -- UV radiation index
    pressure DOUBLE PRECISION,            -- Atmospheric pressure
    solar_irradiance DOUBLE PRECISION,    -- Solar radiation measurement
    weather_icon VARCHAR(50),             -- Weather condition icon code
    created_at TIMESTAMP,                 -- Record creation time
    data_quality_score DOUBLE PRECISION,  -- Quality metric for data
    location_quality_score DOUBLE PRECISION, -- Quality metric for location
    location_quality_reason TEXT,         -- Explanation for location quality
    location_elevation DOUBLE PRECISION,  -- Station elevation
    saved_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (station_id) REFERENCES stations (station_id)
);

-- Station Count Analytics
CREATE TABLE IF NOT EXISTS station_counts (
    id SERIAL PRIMARY KEY,
    timestamp TIMESTAMP DEFAULT CURRENT_TIMESTAMP, -- When count was taken
    total_stations INTEGER,               -- Total number of stations
    high_quality_stations INTEGER,        -- Stations with quality >= 80%
    city VARCHAR(255),                   -- City-level aggregation
    state VARCHAR(255),                  -- State-level aggregation
    country VARCHAR(255),                -- Country-level aggregation
    UNIQUE(timestamp, city, state, country)
);
